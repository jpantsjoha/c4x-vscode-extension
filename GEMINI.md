# Gemini Agent Context & Operational Guide

## üîÑ Public Repository Synchronization

The project maintains a split repository structure:
1.  **Private Source**: `c4model-vscode-extension` (Development, full history, private docs).
2.  **Public Mirror**: `c4x-vscode-extension` (Clean history, release artifacts, public docs).

### Sync Script (`scripts/publish-to-public.sh`)
- **Mechanism**: Uses `rsync` with an allowlist (`--include`) to copy only specific files/folders.
- **Transformation**: Automatically replaces private repo URLs (`c4model-vscode-extension`) with public ones (`c4x-vscode-extension`) in `README.md` using Perl regex.
- **Artifacts**: Copies the latest `.vsix` file and generated marketplace assets.

### Release Workflow
1.  **Bump Version**: Update `package.json` and `CHANGELOG.md`.
2.  **Build VSIX**: Run `make package` to generate `c4x-X.Y.Z.vsix`.
3.  **Sync**: Run `./scripts/publish-to-public.sh ../c4x-vscode-extension`.
4.  **Commit Public**: Commit and push changes in the public repo.
    *   *Note*: The public repo uses `jpantsjoha` as the committer identity.
5.  **Publish**: Run `vsce publish` (or upload manually).

### ‚ö†Ô∏è Caveats & Known Issues
1.  **README Links**: `README.md` in the private repo should point to `docs/architecture/` relative paths. Absolute links to the private repo will be rewritten by the sync script, but relative links are safer.
2.  **CI/CD (GitHub Actions)**:
    *   Public repo has `.github/workflows/ci.yml`.
    *   Tests on Linux require `xvfb-run`.
    *   `actions/upload-artifact` must be v4.
3.  **VSIX Versioning**: `vsce package` creates a filename with the version. Old versions are NOT automatically deleted. You must manually delete old `.vsix` files (`rm *.vsix`) before syncing to avoid polluting the public repo history with binary blobs.
4.  **Marketplace Assets**: Images in `assets/marketplace/images` are auto-generated by `scripts/generate-marketplace-assets.ts` using Playwright. Do not manually edit them if you want them to reflect the code perfectly.